parameter (or :_entries (pair %_Liq_entry_withdraw mumav key_hash) (or (unit %_Liq_entry_deposit) (pair %_Liq_entry_update nat (list (pair address (pair nat bool))))));
storage (pair :storage (key_hash %oracle) (pair (map %meters_balance address mumav) (pair (timestamp %last_update) (pair (mumav %ppkw) (mumav %withdraw_threshold)))));
code { DUP ;
       DIP { CDR @storage_slash_1 } ;
       CAR @parameter_slash_2 ;
       DUP @parameter ;
       IF_LEFT { RENAME @_amount_dest_slash_3 ;
                 { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                 { DIP { DUP } ; SWAP } ;
                 CAR @amount ;
                 { DIP { DUP @storage } ; SWAP } ;
                 { CDR ; CDR ; CDR ; CDR %withdraw_threshold } ;
                 { DIP { DUP @amount } ; SWAP } ;
                 COMPARE ;
                 LT ;
                 IF { PUSH string "Amount below withdraw threshold" ;
                      FAILWITH }
                    { UNIT } ;
                 DROP ;
                 DUP @amount ;
                 BALANCE ;
                 COMPARE ;
                 LT ;
                 IF { PUSH string "Contract has not enough balance" ;
                      FAILWITH }
                    { UNIT } ;
                 DROP ;
                 { DIP { DUP @storage } ; SWAP } ;
                 { CDR ; CAR %meters_balance } ;
                 SENDER ;
                 GET ;
                 IF_NONE { PUSH string "Meter not found on contract" ;
                           FAILWITH }
                         { { DIP { DUP @amount } ; SWAP } ;
                           { DIP { DUP @b } ; SWAP } ;
                           COMPARE ;
                           LT ;
                           IF { PUSH string "Meter has no sufficient balance" ;
                                FAILWITH }
                              { UNIT } ;
                           DROP ;
                           { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                           DUP ;
                           CAR %oracle ;
                           SWAP ;
                           CDR ;
                           CDR ;
                           { DIP { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                           { CDR ; CAR @bl %meters_balance } ;
                           { DIP { { DIP { { DIP { { DIP { DUP @amount } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                           { DIP { { DIP { { DIP { { DIP { DUP @b } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                           DIP { DIP { DIP { DIP { DIP { DROP } } } } } ;
                           SUB ;
                           SOME ;
                           SENDER ;
                           UPDATE @nbl ;
                           PAIR %meters_balance ;
                           SWAP ;
                           PAIR @storage %oracle ;
                           NIL operation ;
                           { DIP { { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                           CDR @dest ;
                           IMPLICIT_ACCOUNT ;
                           { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } ;
                           UNIT ;
                           TRANSFER_TOKENS ;
                           CONS ;
                           PAIR } ;
                 DIP { DROP ; DROP ; DROP } }
               { IF_LEFT { RENAME @__slash_11 ;
                           { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                           DUP @storage ;
                           DUP ;
                           CAR %oracle ;
                           SWAP ;
                           CDR ;
                           CDR ;
                           { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                           { CDR ; CAR %meters_balance } ;
                           SENDER ;
                           GET ;
                           IF_NONE { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } ;
                                     { CDR ; CAR %meters_balance } ;
                                     AMOUNT ;
                                     SOME ;
                                     SENDER ;
                                     UPDATE }
                                   { { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     { CDR ; CAR %meters_balance } ;
                                     SWAP ;
                                     AMOUNT ;
                                     ADD ;
                                     SOME ;
                                     SENDER ;
                                     UPDATE } ;
                           DIP { DIP { DIP { DROP ; DROP } } } ;
                           RENAME @nbl ;
                           PAIR %meters_balance ;
                           SWAP ;
                           PAIR @storage %oracle ;
                           NIL operation ;
                           PAIR }
                         { RENAME @_tezpriceinv_consuml_slash_16 ;
                           DUP ;
                           CAR @tezpriceinv ;
                           { DIP { { DIP { { DIP { DUP @storage } ; SWAP } } ; SWAP } } ; SWAP } ;
                           DUP ;
                           CAR %oracle ;
                           SWAP ;
                           CDR ;
                           DUP ;
                           CAR %meters_balance ;
                           SWAP ;
                           CDR ;
                           CDR ;
                           NOW ;
                           PAIR %last_update ;
                           SWAP ;
                           PAIR %meters_balance ;
                           SWAP ;
                           PAIR @storage %oracle ;
                           { DIP { { DIP { DUP } ; SWAP } } ; SWAP } ;
                           CDR @consuml ;
                           PAIR ;
                           PAIR ;
                           DUP ;
                           CAR ;
                           LEFT (pair :storage (key_hash %oracle) (pair (map %meters_balance address mumav) (pair (timestamp %last_update) (pair (mumav %ppkw) (mumav %withdraw_threshold))))) ;
                           LOOP_LEFT { RENAME @_l_st_slash_22 ; DUP ; CDR @st ; { DIP { DUP } ; SWAP } ; CAR @l ; IF_CONS { { DIP { { DIP { { DIP { { DIP { DUP } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     CDR @tezpriceinv_slash_18 ;
                                     { DIP { { DIP { { DIP { DUP @st } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     { CDR ; CDR ; CDR ; CAR %ppkw } ;
                                     { DIP { { DIP { DUP @x } ; SWAP } } ; SWAP } ;
                                     { CDR ; CAR } ;
                                     MUL ;
                                     MUL @kwvalue ;
                                     { DIP { { DIP { { DIP { DUP @st } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     DUP ;
                                     CAR %oracle ;
                                     SWAP ;
                                     CDR ;
                                     CDR ;
                                     { DIP { { DIP { { DIP { { DIP { { DIP { DUP @st } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     { CDR ; CAR %meters_balance } ;
                                     { DIP { { DIP { { DIP { { DIP { DUP @x } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     CAR ;
                                     GET ;
                                     IF_NONE { { DIP { { DIP { { DIP { DUP @x } ; SWAP } } ; SWAP } } ; SWAP } ;
                                               { CDR ; CDR } ;
                                               IF { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @st } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                    { CDR ; CAR %meters_balance } ;
                                                    { DIP { { DIP { { DIP { DUP @kwvalue } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                    SOME ;
                                                    { DIP { { DIP { { DIP { { DIP { { DIP { DUP @x } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                    CAR ;
                                                    UPDATE }
                                                  { PUSH string "Meter can't have negative balance" ;
                                                    FAILWITH } }
                                             { { DIP { { DIP { { DIP { { DIP { DUP @x } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                               { CDR ; CDR } ;
                                               IF { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @st } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                    { CDR ; CAR %meters_balance } ;
                                                    { DIP { { DIP { { DIP { { DIP { DUP @kwvalue } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                    { DIP { { DIP { DUP @b } ; SWAP } } ; SWAP } ;
                                                    ADD ;
                                                    SOME ;
                                                    { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @x } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                    CAR ;
                                                    UPDATE }
                                                  { { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @st } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                    { CDR ; CAR %meters_balance } ;
                                                    { DIP { { DIP { { DIP { { DIP { DUP @kwvalue } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                    { DIP { { DIP { DUP @b } ; SWAP } } ; SWAP } ;
                                                    SUB ;
                                                    SOME ;
                                                    { DIP { { DIP { { DIP { { DIP { { DIP { { DIP { DUP @x } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } } ; SWAP } ;
                                                    CAR ;
                                                    UPDATE } ;
                                               DIP { DROP } } ;
                                     RENAME @nbl ;
                                     PAIR %meters_balance ;
                                     SWAP ;
                                     PAIR @st_prim_ %oracle ;
                                     { DIP { { DIP { { DIP { DUP @xl_prim_ } ; SWAP } } ; SWAP } } ; SWAP } ;
                                     PAIR ;
                                     LEFT (pair :storage (key_hash %oracle) (pair (map %meters_balance address mumav) (pair (timestamp %last_update) (pair (mumav %ppkw) (mumav %withdraw_threshold))))) ;
                                     DIP { DROP } ;
                                     DIP { DROP ; DROP } }
                                   { DUP @st ;
                                     RIGHT (pair (list (pair address (pair nat bool))) (pair :storage (key_hash %oracle) (pair (map %meters_balance address mumav) (pair (timestamp %last_update) (pair (mumav %ppkw) (mumav %withdraw_threshold)))))) } ; DIP { DROP } ; DIP { DROP } } ;
                           DIP { DROP ; DROP } ;
                           NIL operation ;
                           PAIR } } ;
       DIP { DROP ; DROP } }